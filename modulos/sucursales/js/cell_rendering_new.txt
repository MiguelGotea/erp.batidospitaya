        // Generate cell for each day
        fechasEntrega.forEach((diaInfo, index) => {
            const esHoy = diaInfo.pedido.toDateString() === hoy.toDateString();
            const esPasado = diaInfo.pedido < hoy; // Check if date is in the past
            const beforeDeadline = esHoy ? verificarHoraLimite() : true;
            const tieneConfig = producto.dias_entrega.includes(diaInfo.diaSemanaEntrega);

            // Get existing order for this day
            const fechaEntregaSQL = formatearFechaSQL(diaInfo.entrega);
            const key = `${producto.id_producto}_${fechaEntregaSQL}`;
            const pedido = pedidos[key];
            const cantidad = pedido ? pedido.cantidad : '';
            const fechaHora = pedido ? pedido.fecha_hora_reportada : null;

            // Past dates are always disabled for editing but show as completed
            const habilitado = !esPasado && tieneConfig && beforeDeadline && !isInactive;

            // Check if should show urgent icon (today's column, empty, deadline approaching)
            let mostrarAlerta = false;
            if (esHoy && !cantidad && habilitado && beforeDeadline) {
                const { hours, minutes } = calcularTiempoRestante();
                const totalMinutes = hours * 60 + minutes;
                mostrarAlerta = totalMinutes < 120; // Show alert if less than 2 hours
            }

            // Determine cell content
            let cellContent = '';
            if (esPasado) {
                // Past dates: show quantity with checkmark if exists, otherwise just dash
                if (cantidad) {
                    cellContent = `<span class="cantidad-completada">âœ“ ${cantidad}</span>`;
                } else {
                    cellContent = '<span class="text-muted">-</span>';
                }
            } else if (!tieneConfig || !beforeDeadline || isInactive) {
                // Not configured or deadline passed or inactive
                cellContent = (tieneConfig && !beforeDeadline ? 'ðŸ”’' : '-');
            } else if (cantidad) {
                // Has quantity
                cellContent = `<span class="cantidad-display">${cantidad}</span>`;
            } else if (mostrarAlerta) {
                // Empty with alert
                cellContent = '<span class="urgent-badge">ðŸš¨</span><span class="text-muted">-</span>';
            } else {
                // Empty
                cellContent = '<span class="text-muted">-</span>';
            }

            html += `
                <td class="day-cell ${esPasado ? 'past-date' : ''} ${habilitado ? 'enabled' : 'disabled'} ${cantidad ? 'has-order' : ''} ${mostrarAlerta ? 'alert-cell' : ''}"\r
                    data-producto-id="${producto.id_producto}"\r
                    data-dia-index="${index}"\r
                    data-fecha-entrega="${fechaEntregaSQL}"\r
                    data-fecha-hora="${fechaHora || ''}"\r
                    ${habilitado && puedeEditar ? `onclick="editarCantidad(this)"` : ''}>\r
                    ${cellContent}\r
                </td>\r
            `;
        });
